{"expireTime":9007200845574950000,"key":"transformer-remark-markdown-html-a75f799be1fb40b8a41f82862f744bc5-gatsby-plugin-sharpgatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypantsgatsby-remark-emojis-","val":"<p>こんばんは。\n上島珈琲は連休最後の夜でもみんな作業しまくっててびっくりしていますが、みんなMacで何してるんだろう。</p>\n<p>今回は、<a href=\"http://techeten.xyz/10305\">前回のIstio記事</a>の構成について思っていた疑問点を、GoogleNextにせっかく参加したので聞いてみましたという記事です。</p>\n<h3>前回構成の疑問点</h3>\n<p>前回の構成図は下記のようなものでした。</p>\n<p><a href=\"http://techeten.xyz/wp-content/uploads/2018/09/istio-blog-1.png\"><img src=\"http://techeten.xyz/wp-content/uploads/2018/09/istio-blog-1-580x325.png\"></a></p>\n<p>これにて一見落着っぽいのですが、\nふと「あれ、これマルチクラスタとかできないのでは？」</p>\n<p>Regional IPをそのまま　istio-ingressgatewayのserviceに紐づけてしまったので、\nIstioを使うためにはマルチクラスタ構成ができないのか…？GCLB使いたいときは…？</p>\n<p>これが疑問点でした。</p>\n<h3>The Expert Response</h3>\n<p>Ask the Expertブースにはかの有名なイアン氏がいたので（日本語ペラペラ）、聞いてみました。\nIstioはあまり把握していないとのことだったのですが、\n「istio-ingressgatewayもserviceなのだから、LoadBalancerIPでexposeするのでなく、NodePortで公開してしまって、GCLBからはGKEのinstance groupに対してトラフィックを流せばいいのでは？」とのこと。\nズバリ下記構成です(podは省略)。</p>\n<p><a href=\"http://techeten.xyz/wp-content/uploads/2018/09/stio-blog-2.png\"><img src=\"http://techeten.xyz/wp-content/uploads/2018/09/stio-blog-2-580x354.png\"></a></p>\n<p>た、たしかに。\nIstioの公式にも、istio-ingressgatewayをそのまま公開すべし、といった話はなく、NodePort使う場合には？みたいな説明もありました。\n<a href=\"https://istio.io/docs/tasks/traffic-management/ingress/#determining-the-ingress-ip-and-ports-when-using-a-node-port\">https://istio.io/docs/tasks/traffic-management/ingress/#determining-the-ingress-ip-and-ports-when-using-a-node-port</a></p>\n<p>まだ試してませんが、こうすればGlobal IPも使えるし、マルチクラスタもできそうです。\nどのみち既存構成からダウンタイムなしでIstio化することはなかなか難しそうではありますが。</p>\n<p>ただ、GKEをそこそこ長く運用してきてわかったことの一つに、障害頻度としてはGCLB　> GKEという問題があります。\nそして世界中からの分散トラフィックがくる状況下になければ、マルチクラスタする旨みもどうなんだろう感。\n悩ましいですね！以上です。</p>"}