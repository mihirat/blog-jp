{"expireTime":9007200845577682000,"key":"transformer-remark-markdown-ast-15b657ad0155771c9b1d12383bda9986-gatsby-plugin-sharpgatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypantsgatsby-remark-emojis-","val":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"100万×100万の行列を作って、機械学習をぶん回して…とやっていると\n本当に心配になるくらいmacが熱くなりますし、メモリも食って、計算終わらなくて。。。\nということでスパース表現ですね。","position":{"start":{"line":3,"column":1,"offset":2},"end":{"line":5,"column":17,"offset":97},"indent":[1,1]}}],"position":{"start":{"line":3,"column":1,"offset":2},"end":{"line":5,"column":17,"offset":97},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"スパース表現とは","position":{"start":{"line":7,"column":4,"offset":102},"end":{"line":7,"column":12,"offset":110},"indent":[]}}],"position":{"start":{"line":7,"column":1,"offset":99},"end":{"line":7,"column":12,"offset":110},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"行列の要素のほとんどが0、わずかにしか値が入ってないようなとき、\n例えばこんなん","position":{"start":{"line":9,"column":1,"offset":112},"end":{"line":10,"column":8,"offset":152},"indent":[1]}}],"position":{"start":{"line":9,"column":1,"offset":112},"end":{"line":10,"column":8,"offset":152},"indent":[1]}},{"type":"html","value":"<pre class=\"lang:python decode:true \" title=\"matrix\">array([[4, 0, 9, 0],\n       [0, 7, 0, 0],\n       [0, 0, 0, 0],\n       [0, 0, 0, 5]])</pre>","position":{"start":{"line":12,"column":1,"offset":154},"end":{"line":15,"column":28,"offset":297},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"０をわざわざデータとして保持するんじゃなくて、\nわずかに入る値とその位置だけ保持して、あとは0であるとみなすことで\n持っているべき情報量を落とすための表現です。\nつまり、上の行列は","position":{"start":{"line":17,"column":1,"offset":299},"end":{"line":20,"column":10,"offset":389},"indent":[1,1,1]}}],"position":{"start":{"line":17,"column":1,"offset":299},"end":{"line":20,"column":10,"offset":389},"indent":[1,1,1]}},{"type":"html","value":"<pre class=\"lang:python decode:true \" title=\"matrix\">row  = np.array([0, 3, 1, 0])\ncol  = np.array([0, 3, 1, 2])\ndata = np.array([4, 5, 7, 9])\n</pre>","position":{"start":{"line":22,"column":1,"offset":391},"end":{"line":25,"column":7,"offset":540},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"みたいに表せます。rowとcolがデータの位置、dataがそこに入る値になってます。\nこれを","position":{"start":{"line":27,"column":1,"offset":542},"end":{"line":28,"column":4,"offset":588},"indent":[1]}}],"position":{"start":{"line":27,"column":1,"offset":542},"end":{"line":28,"column":4,"offset":588},"indent":[1]}},{"type":"html","value":"<pre class=\"lang:python decode:true \" title=\"matrix\">sparse_matrix = coo_matrix((data, (row, col)), shape=(4, 4))\n</pre>","position":{"start":{"line":30,"column":1,"offset":590},"end":{"line":31,"column":7,"offset":710},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"というようにしてスパース行列にします。","position":{"start":{"line":33,"column":1,"offset":712},"end":{"line":33,"column":20,"offset":731},"indent":[]}},{"type":"link","title":null,"url":"https://docs.scipy.org/doc/scipy-0.18.1/reference/generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix","children":[{"type":"text","value":"参考：公式","position":{"start":{"line":33,"column":21,"offset":732},"end":{"line":33,"column":26,"offset":737},"indent":[]}}],"position":{"start":{"line":33,"column":20,"offset":731},"end":{"line":33,"column":141,"offset":852},"indent":[]}},{"type":"text","value":"\n元の、全ての値を保持する表現はスパースに対してデンス(dense)と呼ばれます。\n","position":{"start":{"line":33,"column":141,"offset":852},"end":{"line":35,"column":1,"offset":894},"indent":[1,1]}},{"type":"link","title":null,"url":"http://qiita.com/kazk1018/items/c338b2883b4a58298bcf","children":[{"type":"text","value":"こちらの記事","position":{"start":{"line":35,"column":2,"offset":895},"end":{"line":35,"column":8,"offset":901},"indent":[]}}],"position":{"start":{"line":35,"column":1,"offset":894},"end":{"line":35,"column":63,"offset":956},"indent":[]}},{"type":"text","value":"が詳しい。","position":{"start":{"line":35,"column":63,"offset":956},"end":{"line":35,"column":68,"offset":961},"indent":[]}}],"position":{"start":{"line":33,"column":1,"offset":712},"end":{"line":35,"column":68,"offset":961},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"denseの扱いとの違い","position":{"start":{"line":37,"column":4,"offset":966},"end":{"line":37,"column":16,"offset":978},"indent":[]}}],"position":{"start":{"line":37,"column":1,"offset":963},"end":{"line":37,"column":16,"offset":978},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"基本的にはdenseの場合と同様の処理ができます。\nただ、一般的な結合などもスパース行列用に関数がありますのでそちらを利用します。","position":{"start":{"line":39,"column":1,"offset":980},"end":{"line":40,"column":40,"offset":1045},"indent":[1]}},{"type":"link","title":null,"url":"https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.vstack.html","children":[{"type":"text","value":"例：縦方向の結合","position":{"start":{"line":40,"column":41,"offset":1046},"end":{"line":40,"column":49,"offset":1054},"indent":[]}}],"position":{"start":{"line":40,"column":40,"offset":1045},"end":{"line":40,"column":129,"offset":1134},"indent":[]}}],"position":{"start":{"line":39,"column":1,"offset":980},"end":{"line":40,"column":129,"offset":1134},"indent":[1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"scikit-learnと一緒に使う","position":{"start":{"line":42,"column":4,"offset":1139},"end":{"line":42,"column":22,"offset":1157},"indent":[]}}],"position":{"start":{"line":42,"column":1,"offset":1136},"end":{"line":42,"column":22,"offset":1157},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"scikit-learnの多くのアルゴリズムはスパース行列に対応してるので、\n今まで普通に行列を引数で渡していたように引数に渡せます。\n例えば","position":{"start":{"line":44,"column":1,"offset":1159},"end":{"line":46,"column":4,"offset":1230},"indent":[1,1]}},{"type":"link","title":null,"url":"http://www.kamishima.net/archive/recsys.pdf","children":[{"type":"text","value":"推薦システム","position":{"start":{"line":46,"column":5,"offset":1231},"end":{"line":46,"column":11,"offset":1237},"indent":[]}}],"position":{"start":{"line":46,"column":4,"offset":1230},"end":{"line":46,"column":57,"offset":1283},"indent":[]}},{"type":"text","value":"などに使う","position":{"start":{"line":46,"column":57,"offset":1283},"end":{"line":46,"column":62,"offset":1288},"indent":[]}},{"type":"link","title":null,"url":"http://scikit-learn.org/stable/modules/generated/sklearn.decomposition.NMF.html","children":[{"type":"text","value":"非負値行列因子分解(Non-negative Matrix Factorization)","position":{"start":{"line":46,"column":63,"offset":1289},"end":{"line":46,"column":107,"offset":1333},"indent":[]}}],"position":{"start":{"line":46,"column":62,"offset":1288},"end":{"line":46,"column":189,"offset":1415},"indent":[]}},{"type":"text","value":"のParameterの項を見ると","position":{"start":{"line":46,"column":189,"offset":1415},"end":{"line":46,"column":205,"offset":1431},"indent":[]}}],"position":{"start":{"line":44,"column":1,"offset":1159},"end":{"line":46,"column":205,"offset":1431},"indent":[1,1]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"X: {array-like, sparse matrix}, shape (n","position":{"start":{"line":48,"column":3,"offset":1435},"end":{"line":48,"column":43,"offset":1475},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"samples, n","position":{"start":{"line":48,"column":44,"offset":1476},"end":{"line":48,"column":54,"offset":1486},"indent":[]}}],"position":{"start":{"line":48,"column":43,"offset":1475},"end":{"line":48,"column":55,"offset":1487},"indent":[]}},{"type":"text","value":"features) : Data matrix to be decomposed","position":{"start":{"line":48,"column":55,"offset":1487},"end":{"line":48,"column":95,"offset":1527},"indent":[]}}],"position":{"start":{"line":48,"column":3,"offset":1435},"end":{"line":48,"column":95,"offset":1527},"indent":[]}}],"position":{"start":{"line":48,"column":1,"offset":1433},"end":{"line":48,"column":95,"offset":1527},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"となってるので、sparse matrixを引数に取れるよ、ということですね。\nNMFについては","position":{"start":{"line":50,"column":1,"offset":1529},"end":{"line":51,"column":9,"offset":1577},"indent":[1]}},{"type":"link","title":null,"url":"http://qiita.com/takechanman/items/6d1f65f94f7aaa016377","children":[{"type":"text","value":"こちら","position":{"start":{"line":51,"column":10,"offset":1578},"end":{"line":51,"column":13,"offset":1581},"indent":[]}}],"position":{"start":{"line":51,"column":9,"offset":1577},"end":{"line":51,"column":71,"offset":1639},"indent":[]}},{"type":"text","value":"がわかりやすい。\n実例はこんな感じ　","position":{"start":{"line":51,"column":71,"offset":1639},"end":{"line":52,"column":10,"offset":1657},"indent":[1]}},{"type":"link","title":null,"url":"http://www.benfrederickson.com/matrix-factorization/","children":[{"type":"text","value":"http://www.benfrederickson.com/matrix-factorization/","position":{"start":{"line":52,"column":10,"offset":1657},"end":{"line":52,"column":62,"offset":1709},"indent":[]}}],"position":{"start":{"line":52,"column":10,"offset":1657},"end":{"line":52,"column":62,"offset":1709},"indent":[]}}],"position":{"start":{"line":50,"column":1,"offset":1529},"end":{"line":52,"column":62,"offset":1709},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"注意事項","position":{"start":{"line":54,"column":4,"offset":1714},"end":{"line":54,"column":8,"offset":1718},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":1711},"end":{"line":54,"column":8,"offset":1718},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"拙作よりもこちらの記事を読んだ方がよいですが\n","position":{"start":{"line":56,"column":1,"offset":1720},"end":{"line":57,"column":1,"offset":1743},"indent":[1]}},{"type":"link","title":null,"url":"http://hamukazu.com/2014/01/30/sparse-vector-with-scipy-sparse/","children":[{"type":"text","value":"http://hamukazu.com/2014/01/30/sparse-vector-with-scipy-sparse/","position":{"start":{"line":57,"column":1,"offset":1743},"end":{"line":57,"column":64,"offset":1806},"indent":[]}}],"position":{"start":{"line":57,"column":1,"offset":1743},"end":{"line":57,"column":64,"offset":1806},"indent":[]}}],"position":{"start":{"line":56,"column":1,"offset":1720},"end":{"line":57,"column":64,"offset":1806},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"使うためだけの説明をすると、COOは計算に向かないので、CSRかCSCにします。\nCSRは行方向、CSCは列方向の計算を高速化するので、行列の形に応じて使い分けしましょう。","position":{"start":{"line":59,"column":1,"offset":1808},"end":{"line":60,"column":46,"offset":1894},"indent":[1]}}],"position":{"start":{"line":59,"column":1,"offset":1808},"end":{"line":60,"column":46,"offset":1894},"indent":[1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"サンプルコード","position":{"start":{"line":62,"column":4,"offset":1899},"end":{"line":62,"column":11,"offset":1906},"indent":[]}}],"position":{"start":{"line":62,"column":1,"offset":1896},"end":{"line":62,"column":11,"offset":1906},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"例えばさきほどのNMFでは","position":{"start":{"line":64,"column":1,"offset":1908},"end":{"line":64,"column":14,"offset":1921},"indent":[]}}],"position":{"start":{"line":64,"column":1,"offset":1908},"end":{"line":64,"column":14,"offset":1921},"indent":[]}},{"type":"html","value":"<pre class=\"lang:python decode:true \" title=\"matrix\">import pandas as pd\nimport numpy as np\nimport scipy\nfrom sklearn.decomposition import NMF\n\ndef feature_extraction(mat_coo, num_features):\n    X = mat_coo.tocsr()\n    model = NMF(n_components=num_features, init='random', random_state=0)\n    model.fit(X)\n    print('feature extraction done')\n    return model.components_\n\nif __name__ == '__main__':\n\n    num_features = 3\n    print('now loading...')\n    row  = np.array([0, 3, 1, 0])\n    col  = np.array([0, 3, 1, 2])\n    data = np.array([4, 5, 7, 9])\n    mat_coo = scipy.sparse.coo_matrix((data, (row, col)), shape=(4, 4))\n\n    features = feature_extraction(mat_coo, num_features)\n\n</pre>","position":{"start":{"line":66,"column":1,"offset":1923},"end":{"line":89,"column":7,"offset":2612},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"みたいな感じでできます。","position":{"start":{"line":91,"column":1,"offset":2614},"end":{"line":91,"column":13,"offset":2626},"indent":[]}}],"position":{"start":{"line":91,"column":1,"offset":2614},"end":{"line":91,"column":13,"offset":2626},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"圧倒的に高速なので、データがスパースな場合にはぜひ活用しましょう。","position":{"start":{"line":93,"column":1,"offset":2628},"end":{"line":93,"column":34,"offset":2661},"indent":[]}}],"position":{"start":{"line":93,"column":1,"offset":2628},"end":{"line":93,"column":34,"offset":2661},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":93,"column":34,"offset":2661}}}}